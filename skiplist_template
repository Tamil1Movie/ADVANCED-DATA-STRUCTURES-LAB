#include <iostream>
#include <cstdlib>
#include <ctime>
using namespace std;

const float PROBABILITY = 0.5;
const int MAX_LEVEL = 4;

template <typename T>
class Node {
public:
    T value;
    Node<T> **forward;

    Node(T val, int level) {
        value = val;
        forward = new Node<T>*[level + 1];
        for (int i = 0; i <= level; i++) {
            forward[i] = nullptr;
        }
    }
};

template <typename T>
class SkipList {
private:
    Node<T> *header;
    int currentLevel;

    int randomLevel() {
        int level = 0;
        while ((double)rand() / RAND_MAX < PROBABILITY && level < MAX_LEVEL - 1) {
            level++;
        }
        return level;
    }

public:
    SkipList() {
        header = new Node<T>(T(), MAX_LEVEL);
        currentLevel = 0;
        srand(time(0));
    }

    void insert(T value) {
        Node<T> *current = header;
        Node<T> *update[MAX_LEVEL];
        for (int i = currentLevel; i >= 0; i--) {
            while (current->forward[i] && current->forward[i]->value < value) {
                current = current->forward[i];
            }
            update[i] = current;
        }
        current = current->forward[0];
        if (!current || current->value != value) {
            int newLevel = randomLevel();
            if (newLevel > currentLevel) {
                for (int i = currentLevel + 1; i <= newLevel; i++) {
                    update[i] = header;
                }
                currentLevel = newLevel;
            }
            Node<T> *newNode = new Node<T>(value, newLevel);
            for (int i = 0; i <= newLevel; i++) {
                newNode->forward[i] = update[i]->forward[i];
                update[i]->forward[i] = newNode;
            }
            cout << "Inserted: " << value << endl;
        }
    }

    void display() {
        cout << "\nSkip List: " << endl;
        for (int i = 0; i <= currentLevel; i++) {
            Node<T> *node = header->forward[i];
            cout << "Level " << i << ": ";
            while (node) {
                cout << node->value << " ";
                node = node->forward[i];
            }
            cout << endl;
        }
    }

    void search(T value) {
        Node<T> *current = header;
        for (int i = currentLevel; i >= 0; i--) {
            while (current->forward[i] && current->forward[i]->value < value) {
                current = current->forward[i];
            }
        }
        current = current->forward[0];
        if (current && current->value == value) {
            cout << "Found: " << value << endl;
        } else {
            cout << "Not Found: " << value << endl;
        }
    }

    void remove(T value) {
        Node<T> *current = header;
        Node<T> *update[MAX_LEVEL];
        for (int i = currentLevel; i >= 0; i--) {
            while (current->forward[i] && current->forward[i]->value < value) {
                current = current->forward[i];
            }
            update[i] = current;
        }
        current = current->forward[0];
        if (current && current->value == value) {
            for (int i = 0; i <= currentLevel; i++) {
                if (update[i]->forward[i] != current) {
                    break;
                }
                update[i]->forward[i] = current->forward[i];
            }
            delete current;
            while (currentLevel > 0 && header->forward[currentLevel] == nullptr) {
                currentLevel--;
            }
            cout << "Deleted: " << value << endl;
        } else {
            cout << "Not Found for Deletion: " << value << endl;
        }
    }
};

int main() {
    SkipList<int> skipList;
    int n, value;

    cout << "Enter the number of elements to insert: ";
    cin >> n;
    cout << "Enter " << n << " elements: " << endl;
    for (int i = 0; i < n; i++) {
        cin >> value;
        skipList.insert(value);
    }
    skipList.display();
    
    int searchCount;
    cout << "\nEnter the number of elements to search: ";
    cin >> searchCount;
    for (int i = 0; i < searchCount; i++) {
        cout << "Enter element to search: ";
        cin >> value;
        skipList.search(value);
    }
    
    int deleteCount;
    cout << "\nEnter the number of elements to delete: ";
    cin >> deleteCount;
    for (int i = 0; i < deleteCount; i++) {
        cout << "Enter element to delete: ";
        cin >> value;
        skipList.remove(value);
    }
    
    cout << "\nFinal Skip List after deletions:" << endl;
    skipList.display();

    return 0;
}
